<div class="squire-tray" data-position="left">
    
    <!-- TRAY HANDLE -->

    <div class="tray-handle">
        <div class="tray-handle-content-container">

            <button class="tray-handle-button-pin" title="Pin Tray">
                <i class="fas fa-thumbtack"></i>
            </button>
            <button class="tray-handle-button-toggle" title="Toggle Tray">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="tray-handle-button-viewcycle" title="Toggle View Mode">
                <i class="fas {{#if (eq viewMode 'party')}}fa-users{{else if (eq viewMode 'notes')}}fa-sticky-note{{else if (eq viewMode 'codex')}}fa-book{{else if (eq viewMode 'quest')}}fa-scroll{{else}}fa-user{{/if}}"></i>
            </button>

            <div class="tray-handle-content-wrapper">
                {{#if (eq viewMode 'player')}}
                    {{> handle-player}}
                {{else if (eq viewMode 'party')}}
                    {{> handle-party}}
                {{else if (eq viewMode 'notes')}}
                    {{> handle-notes}}
                {{else if (eq viewMode 'codex')}}
                    {{> handle-codex}}
                {{else if (eq viewMode 'quest')}}
                    {{> handle-quest}}
                {{else}}
                    {{> handle-player}}
                {{/if}}
            </div>
        </div>
        <div class="tray-handle-fade-bottom"></div>
    </div>

    

    <!-- TRAY CONTENT -->

    <div class="tray-content">


        <!-- TRAY TABS -->

        <div class="tray-view-tabs">
            <button class="tray-tab-button {{#if (eq viewMode 'player')}}active{{/if}}" data-view="player" title="Player View">
                <i class="fas fa-user"></i> Token
            </button>
            {{#if showTabParty}}
            <button class="tray-tab-button {{#if (eq viewMode 'party')}}active{{/if}}" data-view="party" title="Party View">
                <i class="fas fa-users"></i> Party
            </button>
            {{/if}}
            {{#if showTabNotes}}
            <button class="tray-tab-button {{#if (eq viewMode 'notes')}}active{{/if}}" data-view="notes" title="Notes">
                <i class="fas fa-sticky-note"></i> Notes
            </button>
            {{/if}}
            {{#if showTabCodex}}
            <button class="tray-tab-button {{#if (eq viewMode 'codex')}}active{{/if}}" data-view="codex" title="Codex">
                <i class="fas fa-book"></i> Codex
            </button>
            {{/if}}
            {{#if showTabQuests}}
            <button class="tray-tab-button {{#if (eq viewMode 'quest')}}active{{/if}}" data-view="quest" title="Quests">
                <i class="fas fa-scroll"></i> Quests
            </button>
            {{/if}}
        </div>

        <!-- PANELS -->

        <div class="tray-panel-wrapper">


            <!-- ********** GLOBAL PANELS ********** -->

            <!-- Global Progress Bar -->

            <div class="tray-progress-bar-wrapper" style="display: none;">
                <div class="tray-progress-bar-outter">
                    <div class="tray-progress-bar-inner"><span class="tray-progress-bar-text">Ready...</span></div>
                </div>
            </div>

            <!-- Party Toolbar -->

            <div class="tray-tools-toolbar {{#unless (eq viewMode 'party')}}hidden{{/unless}}">
                {{#if isGM}}
                    <button class="tray-gm-button" data-action="award">
                        <i class="fas fa-medal"></i> Award
                    </button>
                    <button class="tray-tools-button" data-action="select-party">
                        <i class="fas fa-users-viewfinder"></i> Select Party
                    </button>
                {{else}}
                    <button class="tray-tools-button" data-action="select-party">
                        <i class="fas fa-users-viewfinder"></i> Select Owned
                    </button>
                {{/if}}
            </div>


            <!-- Selection Info - Only shown when multiple tokens are selected -->
            {{#if showSelectionBox}}
                <div class="tray-selection-wrapper">
                    <div class="tray-selection-count">{{selectionCount}} tokens selected</div>
                    <div class="tray-selection-actions" data-tooltip="Use Shift+Click to select multiple or modify selection">
                        <button id="button-clear" class="tray-selection-button button-clear" data-tooltip="Clear all selections">Clear</button>
                        {{#if isGM}}
                            <button id="button-combat" class="tray-selection-button button-combat" data-tooltip="Add selected tokens to combat">Combat</button>
                        {{/if}}
                    </div>
                </div>
            {{/if}}

            <!-- ********** PLAYER TAB ********** -->
            
            <div class="tray-view-content player-view {{#unless (eq viewMode 'player')}}hidden{{/unless}}">
                {{#if actor}}
                    <!-- CHARACTER - ALWAYS SHOW -->  
                    <div class="panel-container" data-panel="character" data-clickable="true"></div>


                    <!-- GM DETAILS -->
                    {{#if isGM}}
                        <div class="panel-container" data-panel="gm"></div>
                    {{/if}}


                    <!-- HEALTH -->
                    {{#if @root.settings.showHealthPanel}}
                        {{#unless isHealthPopped}}
                        <div id="health-panel-placeholder" class="panel-placeholder">
                            <div class="panel-container" data-panel="health"></div>
                        </div>
                        {{/unless}}
                    {{/if}}
                    <!-- EXPERIENCE -->  
                    {{#if @root.settings.showExperiencePanel}}
                        <div class="panel-container" data-panel="experience"></div>
                    {{/if}}

                    <!-- ABILITIES -->  
                    {{#if @root.settings.showAbilitiesPanel}}
                        <div class="panel-container" data-panel="abilities"></div>
                    {{/if}}

                    <!-- STATS -->  
                    {{#if @root.settings.showStatsPanel}}
                        <div class="panel-container" data-panel="stats"></div>
                    {{/if}}

                    <!-- DICE TRAY -->
                    {{#if @root.settings.showDiceTrayPanel}}
                        {{#unless isDiceTrayPopped}}
                        <div id="dicetray-panel-placeholder" class="panel-placeholder">
                            <div class="panel-container" data-panel="dicetray"></div>
                        </div>
                        {{/unless}}
                    {{/if}}

                    <!-- MACROS -->
                    {{#if @root.settings.showMacrosPanel}}
                        {{#unless isMacrosPopped}}
                        <div id="macros-panel-placeholder" class="panel-placeholder">
                            <div class="panel-container" data-panel="macros"></div>
                        </div>
                        {{/unless}}
                    {{/if}}

                    <!-- CONTROL PANEL - FOR FAVORITES - ALWAYS SHOWN -->  
                    <div class="panel-container" data-panel="control"></div>

                    <!-- FAVORITES -->  
                    <div class="panel-containers stacked">
                        <div class="panel-container" data-panel="favorites"></div>
                        <div class="panel-container" data-panel="weapons"></div>
                        <div class="panel-container" data-panel="spells"></div>
                        <div class="panel-container" data-panel="features"></div>
                        <div class="panel-container" data-panel="inventory"></div>
                    </div>              
                {{else}}
                    <div class="no-character-message">
                        <p>NO TOKEN SELECTED OR OWNED</p>
                        <p>Select an owned token to get started.</p>
                    </div>
                {{/if}}
            </div>

            <!-- ********** PARTY TAB ********** -->

            <!-- Party Panels -->

            <div class="tray-view-content party-view {{#unless (eq viewMode 'party')}}hidden{{/unless}}">
                <div class="panel-container" data-panel="party"></div>
                {{#if @root.settings.showPartyStatsPanel}}
                <div class="panel-container" data-panel="party-stats"></div>
                {{/if}}
            </div>

            <!-- ********** NOTES TAB ********** -->

            <div class="tray-view-content notes-view {{#unless (eq viewMode 'notes')}}hidden{{/unless}}">
                <div class="panel-container" data-panel="panel-notes"></div>
            </div>

            <!-- ********** CODEX TAB ********** -->

            <div class="tray-view-content codex-view {{#unless (eq viewMode 'codex')}}hidden{{/unless}}">
                <div class="panel-container" data-panel="panel-codex"></div>
            </div>

            <!-- ********** QUEST TAB ********** -->

            <div class="tray-view-content quest-view {{#unless (eq viewMode 'quest')}}hidden{{/unless}}">
                <div class="panel-container" data-panel="panel-quest"></div>
            </div>



        </div>
    </div>
</div> 