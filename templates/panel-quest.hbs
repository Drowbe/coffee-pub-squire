{{#if (eq position "left")}}
    <div class="tray-title-small">
        <span>
            Quests
        </span>
        <div class="quest-toolbar">
            {{#if isGM}}
                <i class="fas fa-plus add-quest-button" title="Add New Quest"></i>
                <i class="fas fa-feather open-quest-journal" title="Open Quest Journal"></i>
            {{/if}}
            <i class="fas fa-sync-alt refresh-quest-button" title="Refresh Quests"></i>
            {{#if isGM}}
                <i class="fas fa-cog set-quest-button" title="Select Journal for Quests"></i>
                <i class="fas fa-file-import import-quests-json" title="Import Quests from JSON"></i>
                <i class="fas fa-file-export export-quests-json" title="Export Quests to JSON"></i>
            {{/if}}
        </div>
    </div>

    <div class="quest-filters">
        <div class="quest-search">
            <input type="text" placeholder="Search quests..." value="{{filters.search}}">
            <i class="fas fa-times clear-search {{#unless filters.search}}disabled{{/unless}}" title="Clear search"></i>
            <i class="fas fa-filter toggle-tags-button {{#unless isTagCloudCollapsed}}active{{/unless}}" title="Toggle tag filters"></i>
        </div>
        {{#if allTags.length}}
            <div class="quest-tag-cloud {{#if isTagCloudCollapsed}}collapsed{{/if}}">
                {{#each allTags}}
                    <span class="quest-tag {{#if (includes ../filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                {{/each}}
            </div>
        {{/if}}
    </div>

    <div class="quest-content">
        {{#if hasJournal}}
            <!-- In Progress Section -->
            <div class="quest-section" data-status="In Progress">
                <div class="quest-category">
                    <h3>
                        <i class="fas fa-bow-arrow"></i>
                        In Progress {{#if statusGroups.inProgress.length}}({{statusGroups.inProgress.length}}){{/if}}
                    </h3>
                    <div class="quest-toolbar">
                        <i class="fas fa-chevron-down" title="Toggle In Progress"></i>
                    </div>
                </div>
                <div class="quest-entries">
                    {{#each statusGroups.inProgress as |entry|}}
                        <div class="quest-entry collapsed">
                            
                            <!-- ENTRY HEADER -->
                            <div class="quest-entry-header">
                                <div class="quest-entry-name">
                                    {{#if (eq entry.category "Main Quest")}}<i class="fas fa-flag quest-type-icon" title="Main Quest"></i>{{else}}<i class="fas fa-map-signs quest-type-icon" title="Side Quest"></i>{{/if}}
                                    {{entry.name}}
                                </div>
                                <div class="quest-toolbar">
                                    <i class="fas fa-thumbtack quest-pin {{#if entry.isPinned}}pinned{{/if}}" data-uuid="{{entry.uuid}}" data-category="{{entry.category}}" title="Pin this quest"></i>
                                    {{#if @root.isGM}}
                                        <i class="fas fa-feather quest-entry-feather" data-uuid="{{entry.uuid}}" title="Open this journal page"></i>
                                        <i class="fas {{#if entry.visible}}fa-eye quest-entry-visibility visible{{else}}fa-eye-slash quest-entry-visibility{{/if}} toggle-visible" data-uuid="{{entry.uuid}}" title="{{#if entry.visible}}Hide from players{{else}}Show to players{{/if}}"></i>
                                        <i class="fas fa-ellipsis-h quest-status-menu" data-uuid="{{entry.uuid}}" title="Change Status"></i>
                                        <div class="quest-status-dropdown" style="display:none;">
                                            <div class="quest-status-option" data-status="Not Started">Not Started</div>
                                            <div class="quest-status-option" data-status="In Progress">In Progress</div>
                                            <div class="quest-status-option" data-status="Complete">Complete</div>
                                            <div class="quest-status-option" data-status="Failed">Failed</div>
                                        </div>
                                    {{/if}}
                                    <i class="fas fa-chevron-right quest-entry-toggle" title="Expand/Collapse"></i>
                                </div>
                            </div>

                            <!-- PROGRESS BAR -->
                            {{#if entry.tasks.length}}
                                {{#if (gt entry.progress 0)}}
                                    <div class="quest-entry-progressbar">
                                        <div class="quest-entry-progressbar-fill" style="width: {{entry.progress}}%;"></div>
                                    </div>
                                {{/if}}
                            {{/if}}

                            <!-- ENTRY CONTENT -->
                            <div class="quest-entry-content">

                                <!-- DESCRIPTION -->
                                {{#if entry.description}}
                                    <div class="quest-entry-divider"></div>
                                    <div class="quest-entry-description">
                                        <!-- IMAGE -->
                                        {{#if entry.img}}
                                        <div class="quest-entry-image">
                                            <img src="{{entry.img}}" alt="{{entry.name}}">
                                        </div>
                                        {{/if}}

                                        <span class="quest-entry-label">Description</span> 
                                        <p>{{entry.description}}</p>
                                    </div>
                                {{/if}}

                                <!-- OBJECTIVES --> 
                                {{#if entry.tasks.length}}
                                    <div class="quest-entry-tasks">
                                        <span class="quest-entry-label">Objectives</span> 
                                        <ul>
                                            {{#each entry.tasks}}
                                                {{#if @root.isGM}}
                                                    <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}} {{#if (eq this.state 'hidden')}}task-hidden{{/if}} {{#if (eq this.state 'failed')}}task-failed{{/if}}">
                                                        <i class="fas {{#if this.completed}}fa-check-square{{else if (eq this.state 'failed')}}fa-square-xmark{{else}}fa-square{{/if}} task-checkbox" data-task-index="{{@index}}"></i>
                                                        <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                    </li>
                                                {{else}}
                                                    {{#if (eq this.state 'hidden')}}
                                                        <li class="task-hidden">
                                                            
                                                            <i class="fas fa-square-question"></i>
                                                            Objective not discovered
                                                        </li>
                                                    {{else if (eq this.state 'failed')}}
                                                        <li class="task-failed">
                                                            <i class="fas fa-square-xmark"></i>
                                                            {{{renderTask this @root.isGM}}}
                                                        </li>
                                                    {{else}}
                                                        <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}}">
                                                            <i class="fas {{#if this.completed}}fa-check-square{{else}}fa-square{{/if}}"></i>
                                                            <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                        </li>
                                                    {{/if}}
                                                {{/if}}
                                            {{/each}}
                                        </ul>
                                    </div>
                                {{/if}}

                                <!-- PLOT HOOK -->
                                {{#if @root.isGM}}
                                    {{#if entry.plotHook}}
                                        <div class="quest-entry-plothook">
                                            <span class="quest-entry-label">Plot Hook</span> 
                                            <p>{{entry.plotHook}}</p>
                                        </div>
                                    {{/if}}
                                {{/if}}
                                
                                <!-- TREASURE -->
                                {{#if entry.reward.treasure.length}}
                                    <div class="quest-entry-divider"></div>
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Treasure</span>
                                        <ul>
                                            {{#if @root.isGM}}
                                                {{#each entry.reward.treasure}}
                                                    <li>
                                                        {{#if this.boundToObjective}}
                                                            {{#unless this.unlocked}}
                                                                <i class="fas fa-lock" style="margin-right: 0.5em; opacity: 0.7;"></i>
                                                            {{/unless}}
                                                        {{/if}}
                                                        {{#if this.uuid}}
                                                            <i class="fas fa-gem treasure-icon"></i>
                                                            <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                        {{else if this.name}}
                                                            <i class="fas fa-gem treasure-icon"></i>
                                                            <span class="treasure-name">{{this.name}}</span>
                                                        {{else}}
                                                            {{this.text}}
                                                        {{/if}}
                                                    </li>
                                                {{/each}}
                                            {{else}}
                                                {{#each entry.reward.treasure}}
                                                    {{#unless this.boundToObjective}}
                                                        <li>
                                                            {{#if this.uuid}}
                                                                <i class="fas fa-gem treasure-icon"></i>
                                                                <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                            {{else}}
                                                                {{#if this.name}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <span class="treasure-name">{{this.name}}</span>
                                                                {{else}}
                                                                    {{this.text}}
                                                                {{/if}}
                                                            {{/if}}
                                                        </li>
                                                    {{else}}
                                                        {{#if this.unlocked}}
                                                            <li class="treasure-unlocked">
                                                                {{#if this.uuid}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                                {{else}}
                                                                    {{#if this.name}}
                                                                        <i class="fas fa-gem treasure-icon"></i>
                                                                        <span class="treasure-name">{{this.name}}</span>
                                                                    {{else}}
                                                                        {{this.text}}
                                                                    {{/if}}
                                                                {{/if}}
                                                            </li>
                                                        {{/if}}
                                                    {{/unless}}
                                                {{/each}}
                                            {{/if}}
                                        </ul>
                                    </div>
                                {{/if}}
                                <!-- DIVIDER -->
                                <div class="quest-entry-divider"></div>

                                <!-- REWARD -->
                                {{#if entry.reward.xp}}
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Experience</span> {{entry.reward.xp}}
                                    </div>
                                {{/if}}

                                <!-- LOCATION -->
                                {{#if entry.location}}
                                    <div class="quest-entry-location">
                                        <span class="quest-entry-label">Location</span> {{entry.location}}
                                    </div>
                                {{/if}}

                                <!-- TIMEFRAME -->  
                                {{#if entry.timeframe.duration}}
                                    <div class="quest-entry-timeframe">
                                        <span class="quest-entry-label">Timeframe</span> {{entry.timeframe.duration}}
                                    </div>
                                {{/if}}

                                <!-- STATUS --> 
                                {{#if entry.status}}
                                    <div class="quest-entry-progress">
                                        <span class="quest-entry-label">Status</span> {{entry.status}}
                                    </div>
                                {{/if}}

                                <!-- PARTICIPANTS -->
                                {{#if entry.participants.length}}
                                    <div class="quest-entry-participants">
                                        <div class="participant-portraits">
                                            {{#each entry.participants}}
                                                <div class="participant-portrait" data-uuid="{{this.uuid}}" title="{{this.name}}">
                                                    <img src="{{this.img}}" alt="{{this.name}}">
                                                </div>
                                            {{/each}}
                                        </div>
                                    </div>
                                {{/if}}

                                <!-- TAGS -->      
                                {{#if entry.tags.length}}
                                    <div class="quest-entry-tags">
                                        {{#each entry.tags}}
                                            <span class="quest-tag {{#if (includes @root.filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                                        {{/each}}
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>

            <!-- Not Started Section -->
            <div class="quest-section" data-status="Not Started">
                <div class="quest-category">
                    <h3>
                        <i class="fas fa-campground"></i>
                        Not Started {{#if statusGroups.notStarted.length}}({{statusGroups.notStarted.length}}){{/if}}
                    </h3>
                    <div class="quest-toolbar">
                        <i class="fas fa-chevron-down" title="Toggle Not Started"></i>
                    </div>
                </div>
                <div class="quest-entries">
                    {{#each statusGroups.notStarted as |entry|}}
                        <div class="quest-entry collapsed">
                            
                            <!-- ENTRY HEADER -->
                            <div class="quest-entry-header">
                                <div class="quest-entry-name">
                                    {{#if (eq entry.category "Main Quest")}}<i class="fas fa-flag quest-type-icon" title="Main Quest"></i>{{else}}<i class="fas fa-map-signs quest-type-icon" title="Side Quest"></i>{{/if}}
                                    {{entry.name}}
                                </div>
                                <div class="quest-toolbar">
                                    {{#if @root.isGM}}
                                        <i class="fas fa-feather quest-entry-feather" data-uuid="{{entry.uuid}}" title="Open this journal page"></i>
                                        <i class="fas {{#if entry.visible}}fa-eye visible{{else}}fa-eye-slash invisible{{/if}} toggle-visible" data-uuid="{{entry.uuid}}" title="{{#if entry.visible}}Hide from players{{else}}Show to players{{/if}}"></i>
                                        <i class="fas fa-ellipsis-h quest-status-menu" data-uuid="{{entry.uuid}}" title="Change Status"></i>
                                        <div class="quest-status-dropdown" style="display:none;">
                                            <div class="quest-status-option" data-status="Not Started">Not Started</div>
                                            <div class="quest-status-option" data-status="In Progress">In Progress</div>
                                            <div class="quest-status-option" data-status="Complete">Complete</div>
                                            <div class="quest-status-option" data-status="Failed">Failed</div>
                                        </div>
                                    {{/if}}
                                    <i class="fas fa-chevron-right quest-entry-toggle" title="Expand/Collapse"></i>
                                </div>
                            </div>

                             <!-- PROGRESS BAR -->
                            {{#if entry.tasks.length}}
                                {{#if (gt entry.progress 0)}}
                                    <div class="quest-entry-progressbar">
                                        <div class="quest-entry-progressbar-fill" style="width: {{entry.progress}}%;"></div>
                                    </div>
                                {{/if}}
                            {{/if}}

                            <!-- ENTRY CONTENT -->
                            <div class="quest-entry-content">

                                <!-- DESCRIPTION -->
                                {{#if entry.description}}
                                    <div class="quest-entry-divider"></div>
                                    <div class="quest-entry-description">
                                        <!-- IMAGE -->
                                        {{#if entry.img}}
                                        <div class="quest-entry-image">
                                            <img src="{{entry.img}}" alt="{{entry.name}}">
                                        </div>
                                        {{/if}}

                                        <span class="quest-entry-label">Description</span> 
                                        <p>{{entry.description}}</p>
                                    </div>
                                {{/if}}
                                
                                
                                <!-- OBJECTIVES --> 
                                {{#if entry.tasks.length}}
                                    <div class="quest-entry-tasks">
                                        <span class="quest-entry-label">Objectives {{#if entry.status}}({{entry.status}}){{/if}}</span> 
                                        <ul>
                                            {{#each entry.tasks}}
                                                {{#if @root.isGM}}
                                                    <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}} {{#if (eq this.state 'hidden')}}task-hidden{{/if}} {{#if (eq this.state 'failed')}}task-failed{{/if}}">
                                                        <i class="fas {{#if this.completed}}fa-check-square{{else if (eq this.state 'failed')}}fa-square-xmark{{else}}fa-square{{/if}} task-checkbox" data-task-index="{{@index}}"></i>
                                                        <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                    </li>
                                                {{else}}
                                                    {{#if (eq this.state 'hidden')}}
                                                        <li class="task-hidden">
                                                            <i class="fas fa-square-question"></i>
                                                            Objective not discovered
                                                        </li>
                                                    {{else if (eq this.state 'failed')}}
                                                        <li class="task-failed">
                                                            <i class="fas fa-square-xmark"></i>
                                                            {{{renderTask this @root.isGM}}}
                                                        </li>
                                                    {{else}}
                                                        <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}}">
                                                            <i class="fas {{#if this.completed}}fa-check-square{{else}}fa-square{{/if}}"></i>
                                                            <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                        </li>
                                                    {{/if}}
                                                {{/if}}
                                            {{/each}}
                                        </ul>
                                    </div>
                                {{/if}}

                                <!-- PLOT HOOK -->
                                {{#if @root.isGM}}
                                    {{#if entry.plotHook}}
                                        <div class="quest-entry-plothook">
                                            <span class="quest-entry-label">Plot Hook</span> 
                                            <p>{{entry.plotHook}}</p>
                                        </div>
                                    {{/if}}
                                {{/if}}

                                <!-- TREASURE -->
                                {{#if entry.reward.treasure.length}}
                                    <div class="quest-entry-divider"></div>
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Treasure</span>
                                        <ul>
                                            {{#if @root.isGM}}
                                                {{#each entry.reward.treasure}}
                                                    <li>
                                                        {{#if this.boundToObjective}}
                                                            {{#unless this.unlocked}}
                                                                <i class="fas fa-lock" style="margin-right: 0.5em; opacity: 0.7;"></i>
                                                            {{/unless}}
                                                        {{/if}}
                                                        {{#if this.uuid}}
                                                            <i class="fas fa-gem treasure-icon"></i>
                                                            <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                        {{else if this.name}}
                                                            <i class="fas fa-gem treasure-icon"></i>
                                                            <span class="treasure-name">{{this.name}}</span>
                                                        {{else}}
                                                            {{this.text}}
                                                        {{/if}}
                                                    </li>
                                                {{/each}}
                                            {{else}}
                                                {{#each entry.reward.treasure}}
                                                    {{#unless this.boundToObjective}}
                                                        <li>
                                                            {{#if this.uuid}}
                                                                <i class="fas fa-gem treasure-icon"></i>
                                                                <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                            {{else}}
                                                                {{#if this.name}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <span class="treasure-name">{{this.name}}</span>
                                                                {{else}}
                                                                    {{this.text}}
                                                                {{/if}}
                                                            {{/if}}
                                                        </li>
                                                    {{else}}
                                                        {{#if this.unlocked}}
                                                            <li class="treasure-unlocked">
                                                                {{#if this.uuid}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                                {{else}}
                                                                    {{#if this.name}}
                                                                        <i class="fas fa-gem treasure-icon"></i>
                                                                        <span class="treasure-name">{{this.name}}</span>
                                                                    {{else}}
                                                                        {{this.text}}
                                                                    {{/if}}
                                                                {{/if}}
                                                            </li>
                                                        {{/if}}
                                                    {{/unless}}
                                                {{/each}}
                                            {{/if}}
                                        </ul>
                                    </div>
                                {{/if}}
                                <!-- DIVIDER -->
                                <div class="quest-entry-divider"></div>

                                <!-- REWARD -->
                                {{#if entry.reward.xp}}
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Experience</span> {{entry.reward.xp}}
                                    </div>
                                {{/if}}

                                <!-- LOCATION -->
                                {{#if entry.location}}
                                    <div class="quest-entry-location">
                                        <span class="quest-entry-label">Location</span> {{entry.location}}
                                    </div>
                                {{/if}}

                                <!-- TIMEFRAME -->
                                {{#if entry.timeframe.duration}}
                                    <div class="quest-entry-timeframe">
                                        <span class="quest-entry-label">Timeframe</span> {{entry.timeframe.duration}}
                                    </div>
                                {{/if}}

                                <!-- STATUS -->
                                {{#if entry.status}}
                                    <div class="quest-entry-progress">
                                        <span class="quest-entry-label">Status</span> {{entry.status}}
                                    </div>
                                {{/if}}

                                <!-- PARTICIPANTS -->
                                {{#if entry.participants.length}}
                                    <div class="quest-entry-participants">
                                        <div class="participant-portraits">
                                            {{#each entry.participants}}
                                                <div class="participant-portrait" data-uuid="{{this.uuid}}" title="{{this.name}}">
                                                    <img src="{{this.img}}" alt="{{this.name}}">
                                                </div>
                                            {{/each}}
                                        </div>
                                    </div>
                                {{/if}}

                                <!-- TAGS -->      
                                {{#if entry.tags.length}}
                                    <div class="quest-entry-tags">
                                        {{#each entry.tags}}
                                            <span class="quest-tag {{#if (includes @root.filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                                        {{/each}}
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>

            <!-- Completed Section -->
            <div class="quest-section" data-status="Complete">
                <div class="quest-category">
                    <h3>
                        <i class="fas fa-crown"></i>
                        Completed {{#if statusGroups.completed.length}}({{statusGroups.completed.length}}){{/if}}
                    </h3>
                    <div class="quest-toolbar">
                        <i class="fas fa-chevron-down" title="Toggle Completed"></i>
                    </div>
                </div>
                <div class="quest-entries">
                    {{#each statusGroups.completed as |entry|}}
                        <div class="quest-entry collapsed">
                            <div class="quest-entry-header">
                                <div class="quest-entry-name">
                                    {{#if (eq entry.category "Main Quest")}}<i class="fas fa-flag quest-type-icon" title="Main Quest"></i>{{else}}<i class="fas fa-map-signs quest-type-icon" title="Side Quest"></i>{{/if}}
                                    {{entry.name}}
                                </div>
                                <div class="quest-toolbar">
                                    {{#if @root.isGM}}
                                        <i class="fas fa-feather quest-entry-feather" data-uuid="{{entry.uuid}}" title="Open this journal page"></i>
                                        <i class="fas {{#if entry.visible}}fa-eye visible{{else}}fa-eye-slash invisible{{/if}} toggle-visible" data-uuid="{{entry.uuid}}" title="{{#if entry.visible}}Hide from players{{else}}Show to players{{/if}}"></i>
                                        <i class="fas fa-ellipsis-h quest-status-menu" data-uuid="{{entry.uuid}}" title="Change Status"></i>
                                        <div class="quest-status-dropdown" style="display:none;">
                                            <div class="quest-status-option" data-status="Not Started">Not Started</div>
                                            <div class="quest-status-option" data-status="In Progress">In Progress</div>
                                            <div class="quest-status-option" data-status="Complete">Complete</div>
                                            <div class="quest-status-option" data-status="Failed">Failed</div>
                                        </div>
                                    {{/if}}
                                    <i class="fas fa-chevron-right quest-entry-toggle" title="Expand/Collapse"></i>
                                </div>
                            </div>
                            {{#if entry.tasks.length}}
                                {{#if (gt entry.progress 0)}}
                                <div class="quest-entry-progressbar">
                                    <div class="quest-entry-progressbar-fill" style="width: {{entry.progress}}%;"></div>
                                </div>
                                {{else}}
                                <div class="quest-entry-divider"></div>
                                {{/if}}
                            {{/if}}
                            <div class="quest-entry-content">
                                <div class="quest-entry-divider"></div>
                                {{#if entry.img}}
                                <div class="quest-entry-image">
                                    <img src="{{entry.img}}" alt="{{entry.name}}">
                                </div>
                                {{/if}}
                                {{#if entry.description}}
                                    <div class="quest-entry-description">
                                        <span class="quest-entry-label">Description</span> 
                                        <p>{{entry.description}}</p>
                                    </div>
                                {{/if}}
                                {{#if entry.tasks.length}}
                                    <div class="quest-entry-tasks">
                                        <span class="quest-entry-label">Objectives {{#if entry.status}}({{entry.status}}){{/if}}</span> 
                                        <ul>
                                            {{#each entry.tasks}}
                                                {{#if @root.isGM}}
                                                    <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}} {{#if (eq this.state 'hidden')}}task-hidden{{/if}} {{#if (eq this.state 'failed')}}task-failed{{/if}}">
                                                        <i class="fas {{#if this.completed}}fa-check-square{{else if (eq this.state 'failed')}}fa-square-xmark{{else}}fa-square{{/if}} task-checkbox" data-task-index="{{@index}}"></i>
                                                        <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                    </li>
                                                {{else}}
                                                    {{#if (eq this.state 'hidden')}}
                                                        <li class="task-hidden">
                                                            <i class="fas fa-square-question"></i>
                                                            Objective not discovered
                                                        </li>
                                                    {{else if (eq this.state 'failed')}}
                                                        <li class="task-failed">
                                                            <i class="fas fa-square-xmark"></i>
                                                            {{{renderTask this @root.isGM}}}
                                                        </li>
                                                    {{else}}
                                                        <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}}">
                                                            <i class="fas {{#if this.completed}}fa-check-square{{else}}fa-square{{/if}}"></i>
                                                            <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                        </li>
                                                    {{/if}}
                                                {{/if}}
                                            {{/each}}
                                        </ul>
                                    </div>
                                {{/if}}

                                {{#if @root.isGM}}
                                    {{#if entry.plotHook}}
                                        <div class="quest-entry-plothook">
                                            <span class="quest-entry-label">Plot Hook</span> 
                                            <p>{{entry.plotHook}}</p>
                                        </div>
                                    {{/if}}
                                {{/if}}


                                {{#if @root.isGM}}
                                    <div class="quest-entry-divider"></div>

                                    {{#if entry.reward.treasure.length}}
                                        <div class="quest-entry-reward">
                                            <span class="quest-entry-label">Treasure</span>
                                            <ul>
                                                {{#each entry.reward.treasure}}
                                                    {{#if this.unlocked}}
                                                        <li class="treasure-unlocked">
                                                            {{#if this.uuid}}
                                                                <i class="fas fa-gem treasure-icon"></i>
                                                                <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                            {{else}}
                                                                {{#if this.name}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <span class="treasure-name">{{this.name}}</span>
                                                                {{else}}
                                                                    {{this.text}}
                                                                {{/if}}
                                                            {{/if}}
                                                        </li>
                                                    {{else}}
                                                        <li class="treasure-locked">
                                                            {{#if this.uuid}}
                                                                <span>{{this.name}}</span>
                                                            {{else}}
                                                                <span>{{this.text}}</span>
                                                            {{/if}}
                                                        </li>
                                                    {{/if}}
                                                {{/each}}
                                            </ul>
                                        </div>
                                    {{/if}}
                                {{/if}}

                                <div class="quest-entry-divider"></div>

                                {{#if entry.reward.xp}}
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Experience</span> {{entry.reward.xp}}
                                    </div>
                                {{/if}}
                                {{#if entry.location}}
                                    <div class="quest-entry-location">
                                        <span class="quest-entry-label">Location</span> {{entry.location}}
                                    </div>
                                {{/if}}

                                {{#if entry.timeframe.duration}}
                                    <div class="quest-entry-timeframe">
                                        <span class="quest-entry-label">Timeframe</span> {{entry.timeframe.duration}}
                                    </div>
                                {{/if}}

                                {{#if entry.status}}
                                    <div class="quest-entry-progress">
                                        <span class="quest-entry-label">Status</span> {{entry.status}}
                                    </div>
                                {{/if}}

                                {{#if entry.participants.length}}
                                    <div class="quest-entry-participants">
                                        <div class="participant-portraits">
                                            {{#each entry.participants}}
                                                <div class="participant-portrait" data-uuid="{{this.uuid}}" title="{{this.name}}">
                                                    <img src="{{this.img}}" alt="{{this.name}}">
                                                </div>
                                            {{/each}}
                                        </div>
                                    </div>
                                {{/if}}

                                <!-- TAGS -->      
                                {{#if entry.tags.length}}
                                    <div class="quest-entry-tags">
                                        {{#each entry.tags}}
                                            <span class="quest-tag {{#if (includes @root.filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                                        {{/each}}
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>

            <!-- Failed Section -->
            <div class="quest-section" data-status="Failed">
                <div class="quest-category">
                    <h3>
                        <i class="fas fa-skull"></i>
                        Failed {{#if statusGroups.failed.length}}({{statusGroups.failed.length}}){{/if}}
                    </h3>
                    <div class="quest-toolbar">
                        <i class="fas fa-chevron-down" title="Toggle Failed"></i>
                    </div>
                </div>
                <div class="quest-entries">
                    {{#each statusGroups.failed as |entry|}}
                        <div class="quest-entry collapsed">
                            <div class="quest-entry-header">
                                <div class="quest-entry-name">
                                    {{#if (eq entry.category "Main Quest")}}<i class="fas fa-flag quest-type-icon" title="Main Quest"></i>{{else}}<i class="fas fa-map-signs quest-type-icon" title="Side Quest"></i>{{/if}}
                                    {{entry.name}}
                                </div>
                                <div class="quest-toolbar">
                                    {{#if @root.isGM}}
                                        <i class="fas fa-feather quest-entry-feather" data-uuid="{{entry.uuid}}" title="Open this journal page"></i>
                                        <i class="fas {{#if entry.visible}}fa-eye visible{{else}}fa-eye-slash invisible{{/if}} toggle-visible" data-uuid="{{entry.uuid}}" title="{{#if entry.visible}}Hide from players{{else}}Show to players{{/if}}"></i>
                                        <i class="fas fa-ellipsis-h quest-status-menu" data-uuid="{{entry.uuid}}" title="Change Status"></i>
                                        <div class="quest-status-dropdown" style="display:none;">
                                            <div class="quest-status-option" data-status="Not Started">Not Started</div>
                                            <div class="quest-status-option" data-status="In Progress">In Progress</div>
                                            <div class="quest-status-option" data-status="Complete">Complete</div>
                                            <div class="quest-status-option" data-status="Failed">Failed</div>
                                        </div>
                                    {{/if}}
                                    <i class="fas fa-chevron-right quest-entry-toggle" title="Expand/Collapse"></i>
                                </div>
                            </div>
                            {{#if entry.tasks.length}}
                                {{#if (gt entry.progress 0)}}
                                <div class="quest-entry-progressbar">
                                    <div class="quest-entry-progressbar-fill" style="width: {{entry.progress}}%;"></div>
                                </div>
                                {{else}}
                                <div class="quest-entry-divider"></div>
                                {{/if}}
                            {{/if}}
                            <div class="quest-entry-content">
                                <div class="quest-entry-divider"></div>
                                {{#if entry.img}}
                                <div class="quest-entry-image">
                                    <img src="{{entry.img}}" alt="{{entry.name}}">
                                </div>
                                {{/if}}
                                {{#if entry.description}}
                                    <div class="quest-entry-description">
                                        <span class="quest-entry-label">Description</span> 
                                        <p>{{entry.description}}</p>
                                    </div>
                                {{/if}}
                                {{#if entry.tasks.length}}
                                    <div class="quest-entry-tasks">
                                        <span class="quest-entry-label">Objectives {{#if entry.status}}({{entry.status}}){{/if}}</span> 
                                        <ul>
                                            {{#each entry.tasks}}
                                                {{#if @root.isGM}}
                                                    <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}} {{#if (eq this.state 'hidden')}}task-hidden{{/if}} {{#if (eq this.state 'failed')}}task-failed{{/if}}">
                                                        <i class="fas {{#if this.completed}}fa-check-square{{else if (eq this.state 'failed')}}fa-square-xmark{{else}}fa-square{{/if}} task-checkbox" data-task-index="{{@index}}"></i>
                                                        <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                    </li>
                                                {{else}}
                                                    {{#if (eq this.state 'hidden')}}
                                                        <li class="task-hidden">
                                                            <i class="fas fa-square-question"></i>
                                                            Objective not discovered
                                                        </li>
                                                    {{else if (eq this.state 'failed')}}
                                                        <li class="task-failed">
                                                            <i class="fas fa-square-xmark"></i>
                                                            {{{renderTask this @root.isGM}}}
                                                        </li>
                                                    {{else}}
                                                        <li class="{{#if (eq this.state 'completed')}}task-complete{{/if}}">
                                                            <i class="fas {{#if this.completed}}fa-check-square{{else}}fa-square{{/if}}"></i>
                                                            <span class="objective-text">{{{renderTask this @root.isGM}}}</span>
                                                        </li>
                                                    {{/if}}
                                                {{/if}}
                                            {{/each}}
                                        </ul>
                                    </div>
                                {{/if}}

                                {{#if @root.isGM}}
                                    {{#if entry.plotHook}}
                                        <div class="quest-entry-plothook">
                                            <span class="quest-entry-label">Plot Hook</span> 
                                            <p>{{entry.plotHook}}</p>
                                        </div>
                                    {{/if}}
                                {{/if}}

                                {{#if @root.isGM}}
                                    <div class="quest-entry-divider"></div>

                                    {{#if entry.reward.treasure.length}}
                                        <div class="quest-entry-reward">
                                            <span class="quest-entry-label">Treasure</span>
                                            <ul>
                                                {{#each entry.reward.treasure}}
                                                    {{#if this.unlocked}}
                                                        <li class="treasure-unlocked">
                                                            {{#if this.uuid}}
                                                                <i class="fas fa-gem treasure-icon"></i>
                                                                <a class="treasure-link" data-uuid="{{this.uuid}}">{{this.name}}</a>
                                                            {{else}}
                                                                {{#if this.name}}
                                                                    <i class="fas fa-gem treasure-icon"></i>
                                                                    <span class="treasure-name">{{this.name}}</span>
                                                                {{else}}
                                                                    {{this.text}}
                                                                {{/if}}
                                                            {{/if}}
                                                        </li>
                                                    {{else}}
                                                        <li class="treasure-locked">
                                                            {{#if this.uuid}}
                                                                <span>{{this.name}}</span>
                                                            {{else}}
                                                                <span>{{this.text}}</span>
                                                            {{/if}}
                                                        </li>
                                                    {{/if}}
                                                {{/each}}
                                            </ul>
                                        </div>
                                    {{/if}}
                                {{/if}}

                                <div class="quest-entry-divider"></div>

                                {{#if entry.reward.xp}}
                                    <div class="quest-entry-reward">
                                        <span class="quest-entry-label">Experience</span> {{entry.reward.xp}}
                                    </div>
                                {{/if}}
                                {{#if entry.location}}
                                    <div class="quest-entry-location">
                                        <span class="quest-entry-label">Location</span> {{entry.location}}
                                    </div>
                                {{/if}}

                                {{#if entry.timeframe.duration}}
                                    <div class="quest-entry-timeframe">
                                        <span class="quest-entry-label">Timeframe</span> {{entry.timeframe.duration}}
                                    </div>
                                {{/if}}

                                {{#if entry.status}}
                                    <div class="quest-entry-progress">
                                        <span class="quest-entry-label">Status</span> {{entry.status}}
                                    </div>
                                {{/if}}

                                {{#if entry.participants.length}}
                                    <div class="quest-entry-participants">
                                        <div class="participant-portraits">
                                            {{#each entry.participants}}
                                                <div class="participant-portrait" data-uuid="{{this.uuid}}" title="{{this.name}}">
                                                    <img src="{{this.img}}" alt="{{this.name}}">
                                                </div>
                                            {{/each}}
                                        </div>
                                    </div>
                                {{/if}}

                                <!-- TAGS -->      
                                {{#if entry.tags.length}}
                                    <div class="quest-entry-tags">
                                        {{#each entry.tags}}
                                            <span class="quest-tag {{#if (includes @root.filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                                        {{/each}}
                                    </div>
                                {{/if}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>
        {{else}}
            <div class="no-quest-selected">
                {{#if isGM}}
                    <p>No journal has been selected for quests.</p>
                    <p>Click the <i class="fas fa-cog"></i> button to select a journal.</p>
                {{else}}
                    <p>No quest journal has been selected by the GM yet.</p>
                {{/if}}
            </div>
        {{/if}}
    </div>
{{/if}} 