{{#if (eq position "left")}}
    <div class="tray-title-small">
        <span>
            Quests
        </span>
        <div class="quest-controls quest-toolbar">
            {{#if isGM}}
                <i class="fa-solid fa-plus add-quest-button" title="Add New Quest"></i>
            {{/if}}
            <i class="fa-solid fa-ellipsis-h quest-titlebar-menu" title="Quest options"></i>
        </div>
    </div>

    <div class="quest-filters">
        <div class="quest-search">
            <input type="text" placeholder="Search quests..." value="{{filters.search}}">
            <i class="fa-solid fa-times clear-search {{#unless filters.hasActiveFilters}}disabled{{/unless}}" title="Clear search"></i>
            <i class="fa-solid fa-filter toggle-tags-button {{#unless isTagCloudCollapsed}}active{{/unless}}" title="Toggle tag filters"></i>
        </div>
        {{#if allTags.length}}
            <div class="quest-tag-cloud {{#if isTagCloudCollapsed}}collapsed{{/if}}">
                {{#each allTags}}
                    <span class="quest-tag {{#if (includes ../filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                {{/each}}
            </div>
        {{/if}}
    </div>

    {{#if hasJournal}}
    <div class="quest-status-section">
        <div class="quest-status-buttons">
            <button class="quest-status-button {{#if (eq filters.statusFilter 'active')}}active{{/if}}" data-status-filter="active" type="button" title="Active quests">
                <i class="fa-solid fa-bow-arrow"></i>
                <span>Active</span>
            </button>
            <button class="quest-status-button {{#if (eq filters.statusFilter 'available')}}active{{/if}}" data-status-filter="available" type="button" title="Available quests">
                <i class="fa-solid fa-campground"></i>
                <span>Available</span>
            </button>
            <button class="quest-status-button {{#if (eq filters.statusFilter 'complete')}}active{{/if}}" data-status-filter="complete" type="button" title="Complete and failed quests">
                <i class="fa-solid fa-crown"></i>
                <span>Complete</span>
            </button>
        </div>
    </div>
    {{/if}}

    <div class="quest-content">
        {{#if hasJournal}}
            <!-- Active (In Progress) Section - no titlebar, always expanded -->
            <div class="quest-section quest-section--no-titlebar" data-status="In Progress">
                <div class="quest-entries">
                    {{#each statusGroups.inProgress as |entry|}}
                        {{> quest-entry entry=entry isGM=@root.isGM filters=@root.filters}}
                    {{/each}}
                </div>
            </div>

            <!-- Available (Not Started) Section - no titlebar, always expanded -->
            <div class="quest-section quest-section--no-titlebar" data-status="Not Started">
                <div class="quest-entries">
                    {{#each statusGroups.notStarted as |entry|}}
                        {{> quest-entry entry=entry isGM=@root.isGM filters=@root.filters}}
                    {{/each}}
                </div>
            </div>

            <!-- Complete Section (Succeeded then Failed, no expandable title) -->
            <div class="quest-section quest-section--no-titlebar" data-status="Complete">
                <div class="quest-entries">
                    {{#if statusGroups.completed.length}}
                        <div class="quest-entries-subgroup-header">Succeeded</div>
                        {{#each statusGroups.completed as |entry|}}
                            {{> quest-entry entry=entry isGM=@root.isGM filters=@root.filters}}
                        {{/each}}
                    {{/if}}
                    {{#if statusGroups.failed.length}}
                        <div class="quest-entries-subgroup-header">Failed</div>
                        {{#each statusGroups.failed as |entry|}}
                            {{> quest-entry entry=entry isGM=@root.isGM filters=@root.filters}}
                        {{/each}}
                    {{/if}}
                </div>
            </div>
        {{else}}
            <div class="no-quest-selected">
                {{#if isGM}}
                    <p>No journal has been selected for quests.</p>
                    <p>Click the <i class="fa-solid fa-cog"></i> button to select a journal.</p>
                {{else}}
                    <p>No quest journal has been selected by the GM yet.</p>
                {{/if}}
            </div>
        {{/if}}
    </div>
{{/if}}
