{{#if (eq position "left")}}
    <div class="tray-title-small">
        <span>
            Codex
        </span>
        <div class="codex-toolbar">
            <i class="fas fa-sync-alt refresh-codex-button" title="Refresh Codex"></i>
            {{#if isGM}}
            <i class="fas fa-file-import import-json-button" title="Import JSON"></i>
            <i class="fas fa-file-export export-json-button" title="Export JSON"></i>
            {{/if}}
        </div>
    </div>

    <div class="codex-filters">
        <div class="codex-search">
            <input type="text" placeholder="Search entries..." value="{{filters.search}}">
            <i class="fas fa-times clear-search {{#unless filters.search}}disabled{{/unless}}" title="Clear search"></i>
            <i class="fas fa-filter toggle-tags-button {{#unless isTagCloudCollapsed}}active{{/unless}}" title="Toggle tag filters"></i>
        </div>
        {{#if allTags.length}}
            <div class="codex-tag-cloud {{#if isTagCloudCollapsed}}collapsed{{/if}}">
                {{#each allTags}}
                    <span class="codex-tag {{#if (includes ../filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                {{/each}}
            </div>
        {{/if}}
    </div>

    <div class="codex-content">
        {{#each categories as |category|}}
            <div class="codex-section" data-category="{{category}}">
                <div class="codex-category">
                    <h3><i class="fas {{#if (eq category "Characters")}}fa-user{{else if (eq category "Locations")}}fa-map{{else if (eq category "Artifacts")}}fa-treasure-chest{{/if}}"></i> {{category}}
                    </h3>
                    <div class="codex-toolbar">
                        {{#if @root.isGM}}
                        <i class="fas fa-cog codex-set-journal" data-category="{{category}}" title="Select Journal for {{category}}"></i>
                        {{/if}}
                        <i class="fas fa-chevron-down" title="Toggle {{category}}"></i>
                    </div>
                </div>
                {{#if (lookup @root.hasJournal category)}}
                    {{#with (lookup @root.data category) as |entries|}}
                        <div class="codex-entries">
                            {{#each entries as |entry|}}
                                <div class="codex-entry collapsed">
                                    <div class="codex-entry-header">
                                        <div class="codex-entry-name">{{entry.name}}</div>
                                        <div class="codex-toolbar">
                                            <i class="fas fa-feather codex-entry-feather" data-uuid="{{entry.uuid}}" title="Open this journal page"></i>
                                            {{#if @root.isGM}}
                                                <i class="fas {{#if entry.identified}}fa-eye identified{{else}}fa-eye-slash unidentified{{/if}} toggle-identified" data-uuid="{{entry.uuid}}" title="{{#if entry.identified}}Hide from players{{else}}Show to players{{/if}}"></i>
                                            {{/if}}
                                            <i class="fas fa-chevron-right codex-entry-toggle" title="Expand/Collapse"></i>
                                        </div>
                                    </div>
                                    <div class="codex-entry-content">
                                        <div class="codex-entry-divider"></div>
                                        {{#if entry.img}}
                                        <div class="codex-entry-image">
                                            <img src="{{entry.img}}" alt="{{entry.name}}">
                                        </div>
                                        {{/if}}
                                        {{#if entry.description}}
                                            <div class="codex-entry-description">{{entry.description}}</div>
                                        {{/if}}
                                        {{#if entry.link}}
                                            <div class="codex-entry-link-block">
                                                <a class="codex-entry-link" data-uuid="{{entry.link.uuid}}" href="#">{{entry.link.label}}</a>
                                            </div>
                                        {{/if}}
                                        {{#if entry.plotHook}}
                                            {{#if @root.isGM}}
                                                <div class="codex-entry-hook"><strong>Plot Hook</strong>: {{entry.plotHook}}</div>
                                            {{/if}}
                                        {{/if}}
                                        {{#if entry.tags.length}}
                                            <div class="codex-entry-tags">
                                                {{#each entry.tags}}
                                                    <span class="codex-tag {{#if (includes @root.filters.tags this)}}selected{{/if}}" data-tag="{{this}}">{{this}}</span>
                                                {{/each}}
                                            </div>
                                        {{/if}}
                                    </div>
                                </div>
                            {{/each}}
                        </div>
                    {{/with}}
                {{else}}
                    <div class="no-codex-selected">
                        {{#if @root.isGM}}
                            <p>No journal has been selected for the {{category}} codex.</p>
                            <p>Click the <i class="fas fa-cog"></i> button to select a journal.</p>
                        {{else}}
                            <p>No codex journal has been selected by the GM yet for {{category}}.</p>
                        {{/if}}
                    </div>
                {{/if}}
            </div>
        {{/each}}
    </div>
{{/if}} 