<div class="features-panel">
    {{#if (eq position "left")}}
    <div class="section-header">
        <div class="header-left">
            <i class="fas fa-stars"></i> Features
        </div>
        <div class="header-right">
            {{!-- Add any additional header controls here if needed --}}
        </div>
    </div>
    {{/if}}
    <div class="weapon-controls">
        <div class="search-container">
            <input type="text" class="weapon-search" placeholder="Search Features...">
            <i class="fas fa-times search-clear" title="Clear Search"></i>
        </div>
    </div>
    <div class="features-category-filters">
        {{#if (lookup featuresByType "class")}}<i class="fas fa-graduation-cap features-category-filter active" data-filter-id="category-feature-class" title="Toggle Class Features"></i>{{/if}}
        {{#if (lookup featuresByType "subclass")}}<i class="fas fa-book-sparkles features-category-filter active" data-filter-id="category-feature-subclass" title="Toggle Subclass Features"></i>{{/if}}
        {{#if (lookup featuresByType "race")}}<i class="fas fa-users features-category-filter active" data-filter-id="category-feature-race" title="Toggle Racial Features"></i>{{/if}}
        {{#if (lookup featuresByType "background")}}<i class="fas fa-scroll features-category-filter active" data-filter-id="category-feature-background" title="Toggle Background Features"></i>{{/if}}
        {{#if (lookup featuresByType "feat")}}<i class="fas fa-hand-sparkles features-category-filter active" data-filter-id="category-feature-feat" title="Toggle Feats"></i>{{/if}}
    </div>

    <div class="weapons-list">
        {{#if features}}
            {{!-- Class Features --}}
            {{#if (lookup featuresByType "class")}}
            <div class="features-header" data-category-id="category-feature-class">Class Features</div>
            {{#each (lookup featuresByType "class") as |feature|}}
            <div class="weapon-item" data-feature-id="{{feature.id}}" data-category-id="category-feature-class">
                <div class="weapon-row">
                    <div class="weapon-image-container">
                        <img class="weapon-image" src="{{feature.img}}" alt="{{feature.name}}"/>
                        <i class="fas fa-dice-d20 weapon-roll-overlay"></i>
                    </div>
                    <div class="weapon-name">
                        {{feature.name}}
                        {{#if feature.actionType}}
                            <span class="weapon-quantity">
                                {{#if (eq feature.actionType "action")}}<i class="fas fa-circle-a"></i>
                                {{else if (eq feature.actionType "bonus")}}<i class="fas fa-circle-b"></i>
                                {{else if (eq feature.actionType "reaction")}}<i class="fas fa-circle-r"></i>
                                {{else if (eq feature.actionType "special")}}<i class="fas fa-circle-s"></i>{{/if}}
                            </span>
                        {{/if}}
                        {{#if (and feature.system.uses feature.system.uses.max)}}
                            <span class="weapon-quantity">({{feature.system.uses.value}}/{{feature.system.uses.max}})</span>
                        {{/if}}
                    </div>
                    <div class="tray-buttons">
                        <i class="fas fa-heart {{#unless feature.isFavorite}}faded{{/unless}}" title="Toggle Favorite"></i>
                        <i class="fas fa-feather"></i>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/if}}

            {{!-- Subclass Features --}}
            {{#if (lookup featuresByType "subclass")}}
            <div class="features-header" data-category-id="category-feature-subclass">Subclass Features</div>
            {{#each (lookup featuresByType "subclass") as |feature|}}
            <div class="weapon-item" data-feature-id="{{feature.id}}" data-category-id="category-feature-subclass">
                <div class="weapon-row">
                    <div class="weapon-image-container">
                        <img class="weapon-image" src="{{feature.img}}" alt="{{feature.name}}"/>
                        <i class="fas fa-dice-d20 weapon-roll-overlay"></i>
                    </div>
                    <div class="weapon-name">
                        {{feature.name}}
                        {{#if feature.actionType}}
                            <span class="weapon-quantity">
                                {{#if (eq feature.actionType "action")}}<i class="fas fa-circle-a"></i>
                                {{else if (eq feature.actionType "bonus")}}<i class="fas fa-circle-b"></i>
                                {{else if (eq feature.actionType "reaction")}}<i class="fas fa-circle-r"></i>
                                {{else if (eq feature.actionType "special")}}<i class="fas fa-circle-s"></i>{{/if}}
                            </span>
                        {{/if}}
                        {{#if (and feature.system.uses feature.system.uses.max)}}
                            <span class="weapon-quantity">({{feature.system.uses.value}}/{{feature.system.uses.max}})</span>
                        {{/if}}
                    </div>
                    <div class="tray-buttons">
                        <i class="fas fa-heart {{#unless feature.isFavorite}}faded{{/unless}}" title="Toggle Favorite"></i>
                        <i class="fas fa-feather"></i>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/if}}

            {{!-- Racial Features --}}
            {{#if (lookup featuresByType "race")}}
            <div class="features-header" data-category-id="category-feature-race">Racial Features</div>
            {{#each (lookup featuresByType "race") as |feature|}}
            <div class="weapon-item" data-feature-id="{{feature.id}}" data-category-id="category-feature-race">
                <div class="weapon-row">
                    <div class="weapon-image-container">
                        <img class="weapon-image" src="{{feature.img}}" alt="{{feature.name}}"/>
                        <i class="fas fa-dice-d20 weapon-roll-overlay"></i>
                    </div>
                    <div class="weapon-name">
                        {{feature.name}}
                        {{#if feature.actionType}}
                            <span class="weapon-quantity">
                                {{#if (eq feature.actionType "action")}}<i class="fas fa-circle-a"></i>
                                {{else if (eq feature.actionType "bonus")}}<i class="fas fa-circle-b"></i>
                                {{else if (eq feature.actionType "reaction")}}<i class="fas fa-circle-r"></i>
                                {{else if (eq feature.actionType "special")}}<i class="fas fa-circle-s"></i>{{/if}}
                            </span>
                        {{/if}}
                        {{#if (and feature.system.uses feature.system.uses.max)}}
                            <span class="weapon-quantity">({{feature.system.uses.value}}/{{feature.system.uses.max}})</span>
                        {{/if}}
                    </div>
                    <div class="tray-buttons">
                        <i class="fas fa-heart {{#unless feature.isFavorite}}faded{{/unless}}" title="Toggle Favorite"></i>
                        <i class="fas fa-feather"></i>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/if}}

            {{!-- Background Features --}}
            {{#if (lookup featuresByType "background")}}
            <div class="features-header" data-category-id="category-feature-background">Background Features</div>
            {{#each (lookup featuresByType "background") as |feature|}}
            <div class="weapon-item" data-feature-id="{{feature.id}}" data-category-id="category-feature-background">
                <div class="weapon-row">
                    <div class="weapon-image-container">
                        <img class="weapon-image" src="{{feature.img}}" alt="{{feature.name}}"/>
                        <i class="fas fa-dice-d20 weapon-roll-overlay"></i>
                    </div>
                    <div class="weapon-name">
                        {{feature.name}}
                        {{#if feature.actionType}}
                            <span class="weapon-quantity">
                                {{#if (eq feature.actionType "action")}}<i class="fas fa-circle-a"></i>
                                {{else if (eq feature.actionType "bonus")}}<i class="fas fa-circle-b"></i>
                                {{else if (eq feature.actionType "reaction")}}<i class="fas fa-circle-r"></i>
                                {{else if (eq feature.actionType "special")}}<i class="fas fa-circle-s"></i>{{/if}}
                            </span>
                        {{/if}}
                        {{#if (and feature.system.uses feature.system.uses.max)}}
                            <span class="weapon-quantity">({{feature.system.uses.value}}/{{feature.system.uses.max}})</span>
                        {{/if}}
                    </div>
                    <div class="tray-buttons">
                        <i class="fas fa-heart {{#unless feature.isFavorite}}faded{{/unless}}" title="Toggle Favorite"></i>
                        <i class="fas fa-feather"></i>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/if}}

            {{!-- Feats --}}
            {{#if (lookup featuresByType "feat")}}
            <div class="features-header" data-category-id="category-feature-feat">Feats</div>
            {{#each (lookup featuresByType "feat") as |feature|}}
            <div class="weapon-item" data-feature-id="{{feature.id}}" data-category-id="category-feature-feat">
                <div class="weapon-row">
                    <div class="weapon-image-container">
                        <img class="weapon-image" src="{{feature.img}}" alt="{{feature.name}}"/>
                        <i class="fas fa-dice-d20 weapon-roll-overlay"></i>
                    </div>
                    <div class="weapon-name">
                        {{feature.name}}
                        {{#if feature.actionType}}
                            <span class="weapon-quantity">
                                {{#if (eq feature.actionType "action")}}<i class="fas fa-circle-a"></i>
                                {{else if (eq feature.actionType "bonus")}}<i class="fas fa-circle-b"></i>
                                {{else if (eq feature.actionType "reaction")}}<i class="fas fa-circle-r"></i>
                                {{else if (eq feature.actionType "special")}}<i class="fas fa-circle-s"></i>{{/if}}
                            </span>
                        {{/if}}
                        {{#if (and feature.system.uses feature.system.uses.max)}}
                            <span class="weapon-quantity">({{feature.system.uses.value}}/{{feature.system.uses.max}})</span>
                        {{/if}}
                    </div>
                    <div class="tray-buttons">
                        <i class="fas fa-heart {{#unless feature.isFavorite}}faded{{/unless}}" title="Toggle Favorite"></i>
                        <i class="fas fa-feather"></i>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/if}}

            <div class="tray-title-small no-matches" style="text-align: center; padding: 10px; display: none;">No matches found</div>
        {{else}}
            <div class="tray-title-small" style="text-align: center; padding: 10px;">No features available</div>
        {{/if}}
    </div>
</div> 