{{#if (eq position "left")}}
    <div class="tray-title-small">
        <span>{{journalName}}</span>
        <div class="notes-controls">
            {{#if isGM}}
            <i class="fa-solid fa-cog set-journal-button" title="Set Journal"></i>
            {{/if}}
            <i class="fa-solid fa-plus new-note-button" title="New Note"></i>
            <i class="fa-solid fa-sync-alt refresh-notes-button" title="Refresh"></i>
        </div>
    </div>

    {{#if hasJournal}}
        <!-- Filters -->
        <div class="notes-filters">
            <!-- Search -->
            <div class="notes-search">
                <input type="text" class="notes-search-input" placeholder="Search notes..." value="{{filters.search}}">
                <i class="fa-solid fa-search"></i>
            </div>

            <!-- Tag Cloud -->
            {{#if allTags.length}}
            <div class="notes-tag-filter">
                <div class="tag-filter-header">
                    <span>Tags</span>
                    <i class="fa-solid fa-chevron-down tag-filter-toggle"></i>
                </div>
                <div class="tag-cloud">
                    {{#each allTags}}
                    <span class="tag-item" data-tag="{{this}}">
                        {{this}}
                    </span>
                    {{/each}}
                </div>
            </div>
            {{/if}}

            <!-- Scene Filter -->
            {{#if scenes.length}}
            <div class="notes-scene-filter">
                <select class="scene-filter-select">
                    <option value="all" {{#if (eq filters.scene 'all')}}selected{{/if}}>All Scenes</option>
                    {{#each scenes}}
                    <option value="{{this}}" {{#if (eq ../filters.scene this)}}selected{{/if}}>{{this}}</option>
                    {{/each}}
                </select>
            </div>
            {{/if}}

            <!-- Visibility Filter -->
            <div class="notes-visibility-filter">
                <select class="visibility-filter-select">
                    <option value="all" {{#if (eq filters.visibility 'all')}}selected{{/if}}>All Notes</option>
                    <option value="private" {{#if (eq filters.visibility 'private')}}selected{{/if}}>Private</option>
                    <option value="party" {{#if (eq filters.visibility 'party')}}selected{{/if}}>Party</option>
                </select>
            </div>
        </div>

        <!-- Notes Container -->
        <div class="notes-content">
            {{#if notes.length}}
                <div class="notes-list">
                    {{#each notes}}
                    <div class="note-card" data-note-uuid="{{uuid}}" data-scene="{{#if sceneName}}{{sceneName}}{{else}}none{{/if}}" data-visibility="{{visibility}}" data-tags="{{#if tags}}{{tags.join ','}}{{/if}}">
                        <!-- Note Header -->
                        <div class="note-header">
                            <span class="note-visibility-badge {{visibility}}">
                                {{#if (eq visibility 'party')}}
                                <i class="fa-solid fa-users"></i>
                                {{else}}
                                <i class="fa-solid fa-lock"></i>
                                {{/if}}
                            </span>
                            <div class="note-title">{{name}}</div>
                            <div class="note-meta">
                                <span class="note-author"><i class="fa-solid fa-user"></i> {{#if authorName}}{{authorName}}{{else}}Unknown{{/if}}</span>
                                {{#if timestamp}}
                                <span class="note-date"><i class="fa-solid fa-clock"></i> {{formatTimestamp timestamp}}</span>
                                {{/if}}
                            </div>
                        </div>

                        <!-- Note Image -->
                        {{#if img}}
                        <div class="note-image">
                            <img src="{{img}}" alt="{{name}}">
                        </div>
                        {{/if}}

                        <!-- Note Content -->
                        <div class="note-content">
                            {{{content}}}
                        </div>

                        <!-- Note Location -->
                        {{#if sceneName}}
                        <div class="note-location">
                            <i class="fa-solid fa-map-pin"></i> {{sceneName}}
                        </div>
                        {{/if}}

                        <!-- Note Tags Section (at bottom like Codex) -->
                        {{#if tags}}
                        {{#if (isArray tags)}}
                        {{#if tags.length}}
                        <div class="note-tags-section">
                            <div class="note-tags-label">Tags:</div>
                            <div class="note-tags">
                                {{#each tags}}
                                <span class="note-tag">{{this}}</span>
                                {{/each}}
                            </div>
                        </div>
                        {{/if}}
                        {{else}}
                        <div class="note-tags-section">
                            <div class="note-tags-label">Tags:</div>
                            <div class="note-tags">
                                <span class="note-tag">{{tags}}</span>
                            </div>
                        </div>
                        {{/if}}
                        {{/if}}

                        <!-- Note Actions -->
                        <div class="note-actions">
                            <button class="note-edit" data-uuid="{{uuid}}" title="Edit Note">
                                <i class="fa-solid fa-edit"></i>
                            </button>
                            {{#if sceneId}}
                            <button class="note-unpin" data-uuid="{{uuid}}" title="Unpin from Canvas">
                                <i class="fa-solid fa-thumbtack"></i>
                            </button>
                            {{else}}
                            <button class="note-pin" data-uuid="{{uuid}}" title="Pin to Canvas">
                                <i class="fa-solid fa-thumbtack"></i>
                            </button>
                            {{/if}}
                            <button class="note-delete" data-uuid="{{uuid}}" title="Delete Note">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    {{/each}}
                </div>
            {{else}}
                <div class="no-notes">
                    <p>No notes found.</p>
                    <button class="new-note-button-large">
                        <i class="fa-solid fa-plus"></i> Create Your First Note
                    </button>
                </div>
            {{/if}}
        </div>
    {{else}}
        <div class="no-journal-selected">
            {{#if isGM}}
            <p>No journal has been selected for notes.</p>
            <p>Click the <i class="fa-solid fa-cog"></i> icon to select a journal.</p>
            <button class="set-journal-button-large">
                <i class="fa-solid fa-book"></i> Select Journal
            </button>
            {{else}}
            <p>No journal has been selected by the GM yet.</p>
            {{/if}}
        </div>
    {{/if}}
{{/if}}
